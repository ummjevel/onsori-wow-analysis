# 발음 학습 분석 시스템 요구사항

## 1. 시스템 개요
발음 학습자의 객관식/OX 문제 답변을 분석하여 개인별 학습 패턴과 발음 구분 능력을 측정하고 맞춤형 피드백을 제공하는 배치 처리 시스템

## 2. 구현 범위
- STT(Speech-to-Text) 기능 제외
- 객관식 및 OX 문제 형태의 발음 테스트 분석
- 정오답 패턴 분석 및 리포트 생성
- 배치 처리 시스템으로 정기적 분석 수행
- 테스트용 웹 인터페이스 제공

## 3. 입력 데이터 구조

### 3.1 기본 데이터
- **정답**: 문제의 실제 정답 (예: "사과")
- **사용자 답변**: 선택지 중 사용자가 선택한 답 (예: "바나나")
- **정오답 기록**: (문제ID, 정답, 사용자 답변, 정오답 여부)

### 3.2 문제 메타데이터
- **문제 유형**: OX 문제, 객관식 문제
- **카테고리**: 과일, 동물, 물건 등
- **음성학적 특성**: 구분 대상 음소 (예: ㅂ-ㅍ, ㅓ-ㅗ)

## 4. 분석 로직

### 4.1 정오답 통계
- **전체 정답률**: 모든 문제에 대한 정답률
- **카테고리별 정답률**: 과일, 동물, 물건 등 범주별 성과
- **문제 유형별 정답률**: OX vs 객관식 문제 성과 비교

### 4.2 혼동 패턴 추적
- **특정 혼동 패턴**: 정답을 특정 선택지와 반복적으로 혼동하는 경우
  - 예: 정답 "사과" → 자주 "바나나" 선택 → 색상/형태 구분 약함
- **음성학적 혼동**: 비슷한 발음의 단어들 간 혼동 패턴
  - 예: ㅂ-ㅍ, ㅓ-ㅗ, ㄱ-ㅋ 등의 구분 능력

### 4.3 문제 유형별 분석
- **OX 문제**: "발음을 들려주고 맞다/아니다 판단" → 청취 구분 능력 측정
- **객관식**: "비슷한 발음 중 맞는 단어 선택" → 음소/모음/자음 구분 능력 측정

## 5. 리포트 출력

### 5.1 강점 분석
- 높은 정답률을 보이는 카테고리
- 예: "동물 관련 단어는 잘 구분합니다"

### 5.2 약점 분석
- 낮은 정답률을 보이는 카테고리
- 자주 혼동하는 선택지 패턴
- 예: "'ㅂ'과 'ㅍ'이 들어간 단어를 혼동합니다"

### 5.3 개선 방향 제안
- 틀린 패턴을 기반으로 한 맞춤형 연습 제안
- 예: "'ㅂ-ㅍ' 발음을 구분하는 단어를 추가 학습하세요"

### 5.4 점수화 시스템
- **세션별 점수**: 각 학습 세션의 정확도
- **누적 진도율**: 전체적인 학습 진전도
- **개선도**: 시간에 따른 성과 향상 추이

## 6. 기술 스택

### 6.1 AI 분석 엔진
- **Ollama**: 로컬 LLM 실행 환경
- **Gemma 모델**: 텍스트 분석 및 패턴 인식

### 6.2 백엔드 시스템
- **FastAPI**: REST API 서버 프레임워크
- **Python**: 주 개발 언어
- **SQLAlchemy**: ORM (Object-Relational Mapping)
- **Python logging**: 내장 로깅 모듈 (RotatingFileHandler 사용)

### 6.3 데이터베이스
- **PostgreSQL**: 메인 데이터베이스
- 사용자별 학습 기록 관리
- 문제별 메타데이터 관리
- 분석 결과 히스토리 보관

### 6.4 배치 처리 시스템
- **APScheduler**: 경량 스케줄링 시스템 (별도 브로커 불필요)
- 정기적 데이터 수집 및 분석 (예: 매일 자정, 매주 등)
- 배치 작업 상태 모니터링

### 6.5 웹 인터페이스
- **FastAPI Static Files**: 정적 파일 서빙
- **HTML/CSS/JavaScript**: 테스트 화면 구현
- **Chart.js** 또는 **D3.js**: 데이터 시각화

## 7. 시스템 아키텍처

### 7.1 배치 처리 워크플로우
1. **데이터 수집**: PostgreSQL에서 새로운 학습 기록 추출
2. **전처리**: 데이터 정제 및 구조화
3. **AI 분석**: Ollama Gemma 모델을 통한 패턴 분석
4. **결과 저장**: 분석 결과를 데이터베이스에 저장
5. **리포트 생성**: 사용자별 맞춤 리포트 생성

### 7.2 API 엔드포인트
- `GET /users/{user_id}/analysis`: 사용자별 분석 결과 조회
- `GET /users/{user_id}/report`: 사용자별 학습 리포트
- `POST /batch/trigger`: 수동 배치 작업 실행
- `GET /batch/status`: 배치 작업 상태 조회
- `GET /test`: 테스트 화면 제공

### 7.3 테스트 인터페이스
- **대시보드**: 전체 사용자 통계 및 배치 작업 상태
- **사용자 검색**: 특정 사용자의 분석 결과 조회
- **리포트 미리보기**: 생성된 리포트 확인
- **배치 작업 관리**: 수동 실행 및 스케줄 관리

## 8. 데이터베이스 스키마

### 8.1 테이블 구조
- **users**: 사용자 정보
- **questions**: 문제 정보 및 메타데이터
- **user_answers**: 사용자 답변 기록
- **analysis_results**: 배치 분석 결과
- **batch_jobs**: 배치 작업 실행 이력

### 8.2 인덱스 및 성능 최적화
- 사용자별, 날짜별 인덱스 구성
- 배치 처리 최적화를 위한 파티셔닝 고려

## 9. 설정 관리

### 9.1 설정 파일 구조
- **config.yaml** 또는 **config.json**: 메인 설정 파일
- **환경별 설정**: development, production 환경 분리
- **민감 정보 보호**: `.env` 파일을 통한 비밀번호, API 키 관리

### 9.2 설정 항목
- **데이터베이스 연결 정보**: 호스트, 포트, 사용자명, 비밀번호
- **Ollama 서버 설정**: 서버 URL, 모델명, 타임아웃 설정
- **배치 스케줄 설정**: 실행 주기, 시간대 설정
- **로깅 설정**: 로그 레벨, 파일 경로, 로테이션 설정, 백업 주기
- **API 서버 설정**: 포트, CORS 설정, 정적 파일 경로

### 9.3 설정 파일 예시
```yaml
database:
  host: localhost
  port: 5432
  database: onsori_analysis

ollama:
  base_url: http://localhost:11434
  model: gemma
  timeout: 30

batch:
  schedule:
    hour: 0
    minute: 0
  timezone: Asia/Seoul

logging:
  level: INFO
  file: logs/app.log
  max_file_size: 10MB
  backup_count: 5
  rotation: daily
```

## 10. 배포 및 운영

### 10.1 환경 설정
- **Ollama 서버**: 로컬 환경에서 Gemma 모델 실행
- **PostgreSQL**: 데이터베이스 서버 설정
- **FastAPI 서버**: 웹 애플리케이션 서버

### 10.2 모니터링
- 배치 작업 실행 로그
- API 응답 시간 모니터링
- 데이터베이스 성능 모니터링

## 11. 확장 가능성
- 추후 STT 기능 통합 대비 구조 설계
- 다양한 언어 지원 확장성
- 실시간 분석 시스템으로 확장 가능
- 다른 AI 모델 연동 가능한 플러그인 구조